<!-- File: show_post.html -->
<!-- Author: Evren Yaman (yamane@bu.edu), 10/3/2025 -->
<!-- Description: Extends base.html; Shows a post and all the photos attached to it -->

{% extends 'mini_insta/base.html' %}

{% block title %}
    Post by {{ post.profile.display_name }}
{% endblock %}

{% block content %}
<div class="wrapper">
  <article>
    <header class="profile-meta">
      <h2 class="profile-name">{{ post.profile.display_name }}</h2>
      <p class="profile-username">{{ post.profile.username }}</p>
      {% with likes=post.get_likes %}
        {% if likes|length == 0 %}
          <p>❤️ 0 likes</p>
        {% elif likes|length == 1 %}
          <p>❤️ Liked by {{ likes.0.profile.display_name|default:likes.0.profile.username }}</p>
        {% else %}
          <p>❤️ Liked by {{ likes.0.profile.display_name|default:likes.0.profile.username }} and {{ likes|length|add:"-1" }} others</p>
        {% endif %}
      {% endwith %}
      <p class="profile-bio">{{ post.caption }}</p>
      <p class="post-time"><time datetime="{{ post.timestamp|date:'c' }}">{{ post.timestamp }}</time></p>
    </header>

    <section>
      <div class="profiles-grid">
        {% for photo in post.get_all_photos %}
          {% if photo.get_image_url %}
            <img
              src="{{ photo.get_image_url }}"
              alt="Photo from post {{ post.id }}"
              class="profile-thumb"
            >
          {% else %}
            <img
              src="https://tse1.mm.bing.net/th/id/OIP.XXWKhZZeWjrUPx-ZSfP0GAHaDt?cb=12&rs=1&pid=ImgDetMain&o=7&rm=3"
              alt="No image available"
              class="profile-thumb"
            >
          {% endif %}
        {% empty %}
          <img
            src="https://tse1.mm.bing.net/th/id/OIP.XXWKhZZeWjrUPx-ZSfP0GAHaDt?cb=12&rs=1&pid=ImgDetMain&o=7&rm=3"
            alt="No images available"
            class="profile-thumb"
          >
        {% endfor %}
      </div>
    </section>

    <section class="post-comments">
      <h3>Comments</h3>

      {% with comments=post.get_all_comments %}
        {% if comments %}
          <ul style="list-style:none; padding:0; margin:0;">
            {% for c in comments %}
              <li style="margin-bottom:0.75rem; border-bottom:1px solid #e2e8f0; padding-bottom:0.5rem;">
                <div>
                  <a href="{% url 'profile' c.profile.pk %}" class="profile-username">
                    {{ c.profile.display_name }}
                  </a>
                  <span class="profile-bio" style="font-size:0.85rem; color:#64748b;">
                    • <time datetime="{{ c.timestamp|date:'c' }}">{{ c.timestamp }}</time>
                  </span>
                </div>
                <p class="profile-bio" style="margin:0.25rem 0 0;">
                  {{ c.text }}
                </p>
              </li>
            {% endfor %}
          </ul>
        {% else %}
          <p class="profile-bio" style="color:#64748b;">No comments yet.</p>
        {% endif %}
      {% endwith %}
    </section>


    <footer>
      <a href="{% url 'update_post' post.pk %}" class="btn btn-secondary">Update</a>
      <a href="{% url 'delete_post' post.pk %}" class="btn btn-danger">Delete</a>

      <a href="{% url 'profile' post.profile.id %}" class="btn btn-secondary">
        ← Back to {{ post.profile.display_name }}’s profile
      </a>
    </footer>
  </article>
</div>
{% endblock %}
